<html>
	<head>

		<script src="d3.min.js"></script>
		<script src="tsne.js"></script>
		<script src="complex_array.js"></script>
		<script src="fft.js"></script>
		<script src="PointCloudVisualizer.js"></script>
		<script src="SongAmplitudeVisualizer.js"></script>
		<script src="TsneMusicVisualizer.js"></script>
		<script src="figue.js"></script>
		<script src="graham_scan.js"></script>
		
		<script>
			
			function getBPM(){
				var text = d3.select("#BPM").node().value;
				var bpm = parseFloat(text);
				if (!isNaN(bpm)){
					return bpm;
				}
				return undefined;
			}
			
			function getBeatOffset(){
				var text = d3.select("#BeatOffset").node().value;
				var offset = parseFloat(text);
				if (!isNaN(offset)){
					return offset;
				}
				return undefined;
			}
			
			window.addEventListener("load",function(){
				tsneMusicVisualizer = new TsneMusicVisualizer("#PointsSvg","#SongSvg");
				var musicUrl = "http://upload.wikimedia.org/wikipedia/en/4/45/ACDC_-_Back_In_Black-sample.ogg";
				tsneMusicVisualizer.loadMusicFromUrl(musicUrl,getBPM(),getBeatOffset());
				
				d3.select("#UseFile").on("click",function(){
					tsneMusicVisualizer.loadMusicFromFileNode(d3.select("#File"),getBPM(),getBeatOffset());
				});
				
				d3.select("#UseUrl").on("click",function(){
					tsneMusicVisualizer.loadMusicFromUrl(d3.select('#Url').attr('value'), getBPM(), getBeatOffset());
				});
				
				d3.select("#AnimateStop").on("click",function(){
					//if we click "Animate", start animation and set label to "Stop"
					var self = this;
					if(this.value==="Animate"){
						tsneMusicVisualizer.animate(function(){
							//when animation stops, change button back to "Animate"
							self.value = "Animate";
						});
						
						this.value = "Stop";
					}
					else{
						tsneMusicVisualizer.stopAnimate();
						self.value = "Animate";
					}
				});
				
				d3.select("#Step").on("click",function(){
					tsneMusicVisualizer.stepAndDraw(d3.select('#Steps').attr('value'));
				});
				
				d3.select("#RunClearKMeans").on("click",function(){
					tsneMusicVisualizer.getKMeans();
				});
			});
			
			
		</script>
	</head>
	<body>
	<svg id="PointsSvg" width="500" height="500" style="border: 1px solid green">
		<defs>
			<radialGradient id="RadialGradient" cx="50%" cy="50%" r="50%" fx="50%" fy="50%">
			  <stop offset="0%" style="stop-color:rgb(255,0,0);stop-opacity:.8" />
			  <stop offset="100%" style="stop-color:rgb(255,0,0);stop-opacity:.2" />
			</radialGradient>
		</defs>
	</svg>
	
	<svg id="SongSvg" width="700" height="200" style="border: 1px solid orange">
	</svg>
	
	</br>
	<label for="Steps">Steps <input type="text" id="Steps" value="1"/> </label>
	<input type="button" id="Step" value="Step And Draw" />
	<input type="button" id="AnimateStop" value="Animate"/>
	<input type="button" id="RunClearKMeans" value="Run K-Means"/>
	
	<br/>
	<label for="BPM">Beats Per Minute <input type="text" id="BPM" value="91"/></label>
	<label for="BeatOffset">Beat Offset (seconds) <input type="text" id="BeatOffset" value="0"/></label>
	
	</br>
	<input type="file" id="File" value="Upload File" name="file" />
	<input type="button" id="UseFile" value="Use This File"/>
	
	</br>
	<input type="text" id="Url" value="http://upload.wikimedia.org/wikipedia/commons/1/1b/The_Entertainer_-_Scott_Joplin.ogg"/>
	<input type="button" id="UseUrl" value="Use This Url" />

	</body>
</html>
